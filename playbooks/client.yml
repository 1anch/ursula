---
- hosts: os-controller
  connection: fireball

  vars_files:
    - vars/common.yml

  tasks:

    - name: openstack creds
      template: src=templates/root/stackrc dest=/root/stackrc

    - name: keystone-client
      git: |
        repo={{ openstack.git_mirror }}/python-keystoneclient.git
        dest=/opt/stack/python-keystoneclient
        version=master
      notify:
        - pip install keystoneclient

    - name: glance-client
      git: |
        repo={{ openstack.git_mirror }}/python-glanceclient.git
        dest=/opt/stack/python-glanceclient
        version=master
      notify:
        - pip install glanceclient

    - name: nova-client
      git: |
        repo={{ openstack.git_mirror }}/python-novaclient.git
        dest=/opt/stack/python-novaclient
        version=master
      notify:
        - pip install novaclient

    - name: quantum-client
      git: |
        repo={{ openstack.git_mirror }}/python-quantumclient.git
        dest=/opt/stack/python-quantumclient
        version=master
      notify:
        - pip install quantumclient

  handlers:
    - name: pip install keystoneclient
      action: command pip install -i {{ openstack.pypi_mirror }} /opt/stack/python-keystoneclient

    - name: pip install glanceclient
      action: command pip install -i {{ openstack.pypi_mirror }} /opt/stack/python-glanceclient

    - name: pip install novaclient
      action: command pip install -i {{ openstack.pypi_mirror }} /opt/stack/python-novaclient

    - name: pip install quantumclient
      action: command pip install -i {{ openstack.pypi_mirror }} /opt/stack/python-quantumclient
