---
- name: cleanup old configs and install logstash-forwarder
  hosts: all
  tasks:
    - include: ../roles/cleanup/tasks/logging.yml
  roles:
    - ../roles/logging

- name: keystone logging
  hosts: controller
  vars_files:
    - ../roles/keystone/defaults/main.yml
  roles:
    - role: ../roles/logging-config
      service: keystone
      logdata: "{{ keystone.logs }}"
  tasks:
    - include: ../roles/keystone/tasks/logging.yml

- name: glance logging
  hosts: controller
  vars_files:
    - ../roles/glance/defaults/main.yml
  roles:
    - role: ../roles/logging-config
      service: glance
      logdata: "{{ glance.logs }}"
  tasks:
    - include: ../roles/glance/tasks/logging.yml

- name: nova logging
  hosts: controller:compute
  vars_files:
    - ../roles/nova-common/defaults/main.yml
  roles:
    - role: ../roles/logging-config
      service: nova
      logdata: "{{ nova.logs }}"
  tasks:
    - include: ../roles/nova-common/tasks/logging.yml

- name: cinder logging
  hosts: controller:compute
  vars_files:
    - ../roles/cinder-common/defaults/main.yml
  roles:
    - role: ../roles/logging-config
      service: cinder
      logdata: "{{ cinder.logs }}"
  tasks:
    - include: ../roles/cinder-common/tasks/logging.yml

- name: neutron logging
  hosts: network:compute
  vars_files:
    - ../roles/neutron-common/defaults/main.yml
  roles:
    - role: ../roles/logging-config
      service: neutron
      logdata: "{{ neutron.logs }}"
  tasks:
    - include: ../roles/neutron-common/tasks/logging.yml

# TODO: These roles are missing logging configs!!!
#- name: horizon logging
#  hosts: controller
#  roles:
#  - role: ../roles/logging-config
#    service: horizon
#    logdata: "{{ horizon.logs }}"

- name: swift logging
  hosts: swiftnode
  tasks:
    - include: ../roles/swift-common/tasks/logging.yml

- name: heat logging
  hosts: heatnode
  roles:
  - role: ../roles/logging-config
    service: heat
    logdata: "{{ heat.logs }}"
  tasks:
    - include: ../roles/heat/tasks/logging.yml

- name: start and check logstash-forwarder is running
  hosts: all
  tasks:
    - name: start and enable logstash-forwarder service
      service: name=logstash-forwarder state=started enabled=yes
