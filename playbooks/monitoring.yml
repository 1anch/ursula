---
# Don't like how I have to register the handler
# many times.

- name: install monitoring and common checks
  hosts: all
  tasks:
  - include: monitoring/tasks/main.yml
  handlers:
  - include: ../handlers/main.yml

- name: install compute checks
  hosts: compute
  tasks:
  - include: monitoring/tasks/compute.yml
  handlers:
  - include: ../handlers/main.yml

- name: install cinder-volume checks
  hosts: cinder_volume
  tasks:
  - include: monitoring/tasks/cinder-volume.yml
  handlers:
  - include: ../handlers/main.yml

- name: install controller checks
  hosts: controller
  tasks:
  - include: monitoring/tasks/controller.yml
  handlers:
  - include: ../handlers/main.yml

- name: install database checks
  hosts: db
  tasks:
  - include: monitoring/tasks/database.yml
  handlers:
  - include: ../handlers/main.yml

- name: install network checks
  hosts: network
  tasks:
  - include: monitoring/tasks/network.yml
  handlers:
  - include: ../handlers/main.yml

- name: install swift checks
  hosts: swiftnode
  tasks:
  - include: monitoring/tasks/swift.yml
  handlers:
  - include: ../handlers/main.yml

- name: install ucarp checks
  hosts: network:swiftnode
  tasks:
  - include: monitoring/tasks/ucarp.yml
  handlers:
  - include: ../handlers/main.yml

- name: install nimble checks
  hosts: controller
  tasks:
    - include: monitoring/tasks/nimble.yml
      when: sensu.nimble_san_ip is defined 
  handlers:
    - include: ../handlers/main.yml
