---
- name: create the keypair
  register: testenv_keypair
  local_action: nova_keypair name={{ testenv_keypair_name }} state=present
- name: persist the keypair
  shell: OLD_UMASK=`umask`; umask 0077; echo "{{ testenv_keypair.key }}" > {{ testenv_keypair_path }}; umask ${OLD_UMASK}
  when: testenv_keypair.changed == True
