---
- name: glance user
  user: name=glance shell=/bin/false

- name: get glance source repo
  git: |
    repo={{ openstack.git_mirror }}/glance.git dest=/opt/stack/glance version={{ glance.rev }}
  notify:
    - pip install glance

- name: /etc/glance
  file: dest=/etc/glance state=directory

- name: glance config
  action: template src={{ item }} dest=/etc/glance
  with_fileglob: ../templates/etc/glance/*
  notify:
    - restart glance-api
    - restart glance-registry

- name: glance-api start script
  template: src=etc/init/glance-api.conf dest=/etc/init/glance-api.conf
  notify:
    - restart glance-api

- name: glance-registry start script
  template: src=etc/init/glance-registry.conf dest=/etc/init/glance-registry.conf
  notify:
    - restart glance-registry

- name: glance-api is running
  service: name=glance-api state=started

- name: glance-registry is running
  service: name=glance-registry state=started

- sensu_service_check: service=glance-api
- sensu_service_check: service=glance-registry
