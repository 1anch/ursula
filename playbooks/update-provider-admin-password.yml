---
- hosts: controller[0]
  tasks:
  - name: update provider_admin password in keystone
    shell: . ~/stackrc && keystone user-list | grep provider_admin | awk '{print $2}'
    register: keystone_uuid
  - shell: . ~/stackrc && keystone user-password-update --pass {{ secrets.provider_admin_password }} {{ keystone_uuid.stdout }}
    when: keystone_uuid.rc == 0

- hosts: all
  tasks:
  - name: update stackrc
    template: src=../roles/client/templates/root/stackrc dest=/root/stackrc
  - name: test stackrc
    shell: . ~/stackrc && keystone user-list
