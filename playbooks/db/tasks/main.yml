---
- name: install mysql
  apt: pkg=mysql-server

- name: listen on all ips
  template: src=etc/mysql/conf.d/all_ips.cnf dest=/etc/mysql/conf.d/all_ips.cnf mode=0644
  notify: restart mysql

- name: python mysqldb
  apt: pkg=python-mysqldb

- name: databases
  mysql_db: db={{ item }} state=present
  with_items:
    - keystone
    - glance
    - nova
    - neutron

- name: database users
  mysql_user: |
    name={{ item }}
    host=%
    password={{ secrets.db_password }}
    priv={{ item }}.*:ALL
    state=present
  with_items:
    - keystone
    - glance
    - nova
    - neutron

- name: local database users
  mysql_user: |
    name={{ item }}
    host=localhost
    password={{ secrets.db_password }}
    priv={{ item }}.*:ALL
    state=present
  with_items:
    - keystone
    - glance
    - nova
    - neutron

- include: sync.yml
