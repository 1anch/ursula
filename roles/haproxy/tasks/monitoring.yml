---
- name: haproxy check
  sensu_check: name=haproxy plugin=check-procs.rb
               args="-p 'haproxy.*-f /etc/haproxy/haproxy.cfg' -w 5 -c 10 -W 1 -C 1"
  notify: restart sensu-client

- name: haproxy check backends
  sensu_check: name=haproxy plugin=check-haproxy.rb
               args="-p '-c 100 -S /var/run/haproxy.stat -A"
  notify: restart sensu-client

- name: haproxy metrics
  template: src=etc/collectd/plugins/haproxy.conf dest=/etc/collectd/plugins/haproxy.conf
  notify: restart collectd
  when: collectd is defined and collectd.enabled|bool
  tags: collectd
