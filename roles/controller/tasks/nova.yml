---
- name: nova controller service start scripts
  action: template src=etc/init/{{ item }}.conf dest=/etc/init/{{ item }}.conf
  with_items:
    - nova-api
    - nova-cert
    - nova-conductor
    - nova-consoleauth
    - nova-scheduler

- name: nova controller services
  action: service name={{ item }} state=started
  with_items:
    - nova-api
    - nova-cert
    - nova-conductor
    - nova-consoleauth
    - nova-scheduler

- sensu_process_check: service={{ item }}
  with_items:
    - nova-api
    - nova-cert
    - nova-conductor
    - nova-consoleauth
    - nova-scheduler
  notify: restart sensu-client

- sensu_check: name=check-nova-api plugin=check-http.rb args='-u https://localhost:8777/v2 -k true --password {{ secrets.admin_password }} --username admin'
  notify: restart sensu-client
