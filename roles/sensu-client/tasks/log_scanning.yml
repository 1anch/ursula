---
- name: log scanning caching dir
  file: path=/var/cache/check-log owner=sensu state=directory

- name: enable log scanning
  when: monitoring.scan_for_log_errors
  sensu_check: name=check-log-{{ item }} plugin=check-log.rb use_sudo=true auto_resolve=false args="-f /var/log/upstart/{{ item }}.log -q ERROR"
  with_items: logs_to_scan
  notify: restart sensu-client

- name: disable log scanning
  when: monitoring.scan_for_log_errors == false
  file: path=/etc/sensu/conf.d/checks/check-log-{{ item }}.json state=absent
  with_items: logs_to_scan
  notify: restart sensu-client
