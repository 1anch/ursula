#  /etc/bbclog.conf    Configuration file for bbclog.
#
#                       For more information see
#                       /usr/share/doc/rsyslog-doc/html/rsyslog_conf.html
#
#  Default logging rules can be found in /etc/bbclog.d/50-default.conf

#################
#### MODULES ####
#################

module(load="imuxsock")
module(load="imudp")
module(
  load="impstats"
  format="json"
  log.file="/var/log/bbclog-stats.log"
)

###########################
#### GLOBAL DIRECTIVES ####
###########################
$Umask 0022
$PrivDropToUser syslog
$PrivDropToGroup syslog

# Filter duplicated messages
$RepeatedMsgReduction on

global(
  workDirectory="/var/spool/bbclog"
  action.reportSuspensionContinuation="on"
  localHostname="{{ inventory_hostname }}"
  maxMessageSize="2097152" # 2MB
  janitorInterval="1" # minutes
{% if bbclog.forward.tls.enabled %}
  # certificate files - just CA for a client
  defaultNetstreamDriverCAFile="/usr/local/share/ca-certificates/bbclog-forward.crt"
{% endif %}
)

#
# Set the default permissions for all log files.
#
module(
  load="builtin:omfile"
  dirCreateMode="0755"
  fileCreateMode="0640"
  fileOwner="syslog"
  fileGroup="adm"
  template="RSYSLOG_TraditionalFileFormat"
)

#
# Configure the Main Queue once
#
main_queue(
  queue.type="LinkedList"
  queue.size="250000"
  queue.dequeuebatchsize="1000"
  queue.lowwatermark="100000"
  queue.highwatermark="200000"
  queue.discardmark="225000"
  queue.discardseverity="4"
  queue.filename="main_queue"
  queue.maxdiskspace="10g"
  queue.checkpointinterval="1000"
  queue.workerthreads="2"
  queue.saveonshutdown="on"
)

################
#### INPUTS ####
################

input(
  type="imudp"
  Port="514"
)

##################
#### INCLUDES ####
##################

$IncludeConfig /etc/bbclog.d/*.conf
