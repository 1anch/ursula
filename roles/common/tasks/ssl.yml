---
- name: custom CA cert directory
  file: dest=/usr/share/ca-certificates/openstack state=directory

- name: (possibly self-signed) ssl cert
  template: src=openstack.crt dest=/usr/share/ca-certificates/openstack/{{ endpoints.main }}.crt
  notify:
    - refresh CAs

- file: dest=/opt/stack/ssl state=directory
- template: src=openstack.crt dest=/opt/stack/ssl/openstack.crt mode=0645

- name: use system httplib2 and request Python modules that already use system CA certs
  apt: pkg={{ item }}
  with_items:
    - python-httplib2
    - python-requests

- lineinfile: >
    dest=/etc/ca-certificates.conf
    regexp=openstack/{{ endpoints.main }}.crt
    line=openstack/{{ endpoints.main }}.crt
  notify: refresh CAs

- meta: flush_handlers
