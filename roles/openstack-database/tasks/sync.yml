---
- name: discover db current status
  exit_status: echo "select {{ db_version_col|default('version') }} from {{ db_version_table|default('migrate_version') }}" | mysql {{ database_name }} | egrep "^$({{ db_sync_cmd|default(database_name ~ '-manage') }} {{ db_version|default('db_version') }})$"
  run_once: true
  register: db_current

- name: sync the db
  command: "{{ db_sync_cmd|default(database_name ~ '-manage') }} {{ db_sync|default('db_sync') }}"
  run_once: true
  when: db_current.status != 0 or force_sync|default('False')
